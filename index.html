<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Game B·∫£n Quy·ªÅn</title>

    <!-- Bootstrap & jQuery -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <style>
        /* Thi·∫øt k·∫ø danh s√°ch game */
        .game-card {
            transition: 0.3s;
            border-radius: 10px;
            overflow: hidden;
        }
        .game-card:hover {
            transform: scale(1.05);
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        }
        .game-card img {
            height: 200px;
            object-fit: cover;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
    </style>
</head>
<body>
    <script>
        $(document).ready(function () {
            updateAuthUI();
    
            function updateAuthUI() {
                let currentUser = JSON.parse(localStorage.getItem("currentUser"));
    
                if (currentUser) {
                    $("#user-info").show();
                    $("#username-display").text(currentUser.username);
                    $("#logout-btn").show();
                    $("#login-btn").hide();
                } else {
                    $("#user-info").hide();
                    $("#logout-btn").hide();
                    $("#login-btn").show();
                }
            }
    
            $("#logout-btn a").click(function (e) {
                e.preventDefault();
                localStorage.removeItem("currentUser");
                alert("‚úÖ B·∫°n ƒë√£ ƒëƒÉng xu·∫•t!");
                window.location.reload();
            });
        });
    </script>    
    <!-- Thanh ƒëi·ªÅu h∆∞·ªõng -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="Logo.png" alt="Shop Game" width="40" class="rounded-circle"> SHOP IRONIX GAMING
            </a>            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="index.html">Trang ch·ªß</a></li>
                    <li class="nav-item"><a class="nav-link" href="tatcagame.html">T·∫•t c·∫£ Game</a></li>
                    <li class="nav-item"><a class="nav-link" href="giohang.html">Gi·ªè h√†ng üõí <span class="badge bg-danger" id="cart-count">0</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="donhang.html">ƒê∆°n h√†ng</a></li>
                    <li class="nav-item" id="user-info" style="display: none;">
                        <span class="nav-link">üë§ <strong id="username-display"></strong></span>
                    </li>
                    <li class="nav-item" id="login-btn">
                        <a class="nav-link" href="dangnhap.html">ƒêƒÉng nh·∫≠p</a>
                    </li>
                    <li class="nav-item" id="logout-btn" style="display: none;">
                        <a class="nav-link" href="#">üö™ ƒêƒÉng xu·∫•t</a>
                    </li>                    
                </ul>
            </div>
        </div>
    </nav>

    <!-- Banner -->
    <div class="container mt-4">
        <div class="alert alert-primary text-center" role="alert">
            üöÄ Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi <strong>Shop Game B·∫£n Quy·ªÅn</strong> - N∆°i mua game ch·∫•t l∆∞·ª£ng v·ªõi gi√° t·ªët nh·∫•t!
        </div>
    </div>

    <!-- B·ªô l·ªçc danh m·ª•c -->
    <div class="container mt-3">
        <label for="category-filter" class="form-label">L·ªçc theo danh m·ª•c</label>
        <select id="category-filter" class="form-select">
            <option value="all">T·∫•t c·∫£</option>
            <option value="H√†nh ƒë·ªông">H√†nh ƒë·ªông</option>
            <option value="Nh·∫≠p vai">Nh·∫≠p vai</option>
            <option value="Phi√™u l∆∞u">Phi√™u l∆∞u</option>
            <option value="Th·ªÉ thao">Th·ªÉ thao</option>
            <option value="B·∫Øn s√∫ng">B·∫Øn s√∫ng</option>
        </select>
    </div>

    
    <!-- Danh s√°ch game -->
    <div class="container mt-4">
        <h2 class="text-center mb-4">üéÆ Danh S√°ch Game N·ªïi B·∫≠t</h2>
        <div class="row" id="game-list">
            <!-- D·ªØ li·ªáu game t·ª´ API s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-4">
        &copy; 2025 Shop Game B·∫£n Quy·ªÅn | All Rights Reserved
    </footer>

    <!-- Th√¥ng b√°o th√™m gi·ªè h√†ng -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="cart-toast" class="toast align-items-center text-white bg-success border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    ‚úÖ ƒê√£ th√™m v√†o gi·ªè h√†ng!
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        const API_URL = "https://67e0e43e58cc6bf785234aa9.mockapi.io/games";

        $(document).ready(function () {
            loadCartCount();
            loadGames();

            // Khi ch·ªçn danh m·ª•c, t·∫£i game theo danh m·ª•c ƒë√≥
            $("#category-filter").change(function () {
                let selectedCategory = $(this).val();
                loadGames(selectedCategory);
            });

            function loadGames(category = "all") {
                $.get(API_URL, function (games) {
                    let gameHtml = "";
                    games.forEach(game => {
                        if (category === "all" || game.category === category) {
                            gameHtml += `
                                <div class="col-md-4">
                                    <div class="card game-card mb-4">
                                        <img src="${game.image}" class="card-img-top" alt="${game.name}">
                                        <div class="card-body">
                                            <h5 class="card-title">${game.name}</h5>
                                            <p class="card-text text-muted">üìå Danh m·ª•c: ${game.category}</p>
                                            <p class="card-text"><strong>üí∞ Gi√°:</strong> ${game.price.toLocaleString()} VNƒê</p>
                                            <p class="card-text"><strong>M√¥ t·∫£:</strong> ${game.description || "Kh√¥ng c√≥ m√¥ t·∫£"}</p>
                                            <button class="btn btn-primary add-to-cart"
                                                data-id="${game.id}"
                                                data-name="${game.name}"
                                                data-price="${game.price}"
                                                data-image="${game.image}">
                                                üõí Th√™m v√†o gi·ªè h√†ng
                                            </button>
                                        </div>
                                    </div>
                                </div>`;
                        }
                    });
                    $("#game-list").html(gameHtml);
                    attachCartEvents(); // K√≠ch ho·∫°t l·∫°i s·ª± ki·ªán th√™m gi·ªè h√†ng
                });
            }

            function attachCartEvents() {
                $(".add-to-cart").click(function () {
                    let game = {
                        id: $(this).data("id"),
                        name: $(this).data("name"),
                        price: $(this).data("price"),
                        image: $(this).data("image"),
                        quantity: 1
                    };
                    addToCart(game);
                });
            }

            function addToCart(game) {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                let existingGame = cart.find(item => item.id.toString() === game.id.toString());
                if (existingGame) {
                    existingGame.quantity += 1;
                } else {
                    cart.push(game);
                }
                localStorage.setItem("cart", JSON.stringify(cart));
                loadCartCount();
                $("#cart-toast").toast("show");
            }

            function loadCartCount() {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                let totalCount = cart.reduce((total, game) => total + game.quantity, 0);
                $("#cart-count").text(totalCount);
            }
        });
    </script>
</body>
</html>
