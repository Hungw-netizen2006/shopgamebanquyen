<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè H√†ng - Shop Game</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

    <!-- Thanh ƒëi·ªÅu h∆∞·ªõng -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">Shop Game</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Trang ch·ªß</a></li>
                    <li class="nav-item"><a class="nav-link" href="tatcagame.html">T·∫•t c·∫£ Game</a></li>
                    <li class="nav-item"><a class="nav-link active" href="giohang.html">Gi·ªè h√†ng üõí <span class="badge bg-danger" id="cart-count">0</span></a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- N·ªôi dung Gi·ªè h√†ng -->
    <div class="container mt-4">
        <h2 class="text-center">üõí Gi·ªè H√†ng C·ªßa B·∫°n</h2>
        <div class="row">
            <div class="col-md-8">
                <table class="table table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>H√¨nh ·∫¢nh</th>
                            <th>T√™n Game</th>
                            <th>Gi√°</th>
                            <th>S·ªë l∆∞·ª£ng</th>
                            <th>Th√†nh ti·ªÅn</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="cart-items">
                        <!-- D·ªØ li·ªáu gi·ªè h√†ng s·∫Ω ƒë∆∞·ª£c load ·ªü ƒë√¢y -->
                    </tbody>
                </table>
                <button class="btn btn-danger" id="clear-cart">üóë X√≥a to√†n b·ªô gi·ªè h√†ng</button>
            </div>
            <div class="col-md-4">
                <div class="p-3 border bg-light">
                    <h4>T·ªïng c·ªông: <span id="total-price">0</span> VNƒê</h4>
                    <button class="btn btn-success w-100 mt-3" id="checkout">üõí Thanh to√°n</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            loadCart();
            updateCartCount();

            function loadCart() {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                let cartHtml = "";
                let total = 0;

                if (cart.length === 0) {
                    $("#cart-items").html(`<tr><td colspan="6" class="text-center">Gi·ªè h√†ng tr·ªëng</td></tr>`);
                    $("#total-price").text("0");
                    return;
                }

                cart.forEach((game, index) => {
                    let subtotal = game.price * game.quantity;
                    total += subtotal;
                    cartHtml += `
                        <tr>
                            <td><img src="${game.image}" width="60"></td>
                            <td>${game.name}</td>
                            <td>${game.price.toLocaleString()} VNƒê</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary update-quantity" data-index="${index}" data-type="decrease">-</button>
                                ${game.quantity}
                                <button class="btn btn-sm btn-outline-primary update-quantity" data-index="${index}" data-type="increase">+</button>
                            </td>
                            <td>${subtotal.toLocaleString()} VNƒê</td>
                            <td>
                                <button class="btn btn-sm btn-danger remove-item" data-index="${index}">‚ùå X√≥a</button>
                            </td>
                        </tr>`;
                });

                $("#cart-items").html(cartHtml);
                $("#total-price").text(total.toLocaleString());
            }

            function updateCartCount() {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                let totalCount = cart.reduce((total, game) => total + game.quantity, 0);
                $("#cart-count").text(totalCount);
            }

            $(document).on("click", ".update-quantity", function () {
                let index = $(this).data("index");
                let type = $(this).data("type");
                let cart = JSON.parse(localStorage.getItem("cart")) || [];

                if (type === "increase") {
                    cart[index].quantity++;
                } else if (type === "decrease" && cart[index].quantity > 1) {
                    cart[index].quantity--;
                } else {
                    cart.splice(index, 1);
                }

                localStorage.setItem("cart", JSON.stringify(cart));
                loadCart();
                updateCartCount();
            });

            $(document).on("click", ".remove-item", function () {
                let index = $(this).data("index");
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                cart.splice(index, 1);

                localStorage.setItem("cart", JSON.stringify(cart));
                loadCart();
                updateCartCount();
            });

            $("#clear-cart").click(function () {
                if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô gi·ªè h√†ng?")) {
                    localStorage.removeItem("cart");
                    loadCart();
                    updateCartCount();
                }
            });

            $("#checkout").click(function () {
                if (confirm("X√°c nh·∫≠n thanh to√°n?")) {
                    let cart = JSON.parse(localStorage.getItem("cart")) || [];
                    if (cart.length === 0) {
                        alert("Gi·ªè h√†ng tr·ªëng!");
                        return;
                    }

                    let orders = JSON.parse(localStorage.getItem("orders")) || [];
                    let newOrder = {
                        date: new Date().toLocaleString(),
                        items: cart
                    };

                    orders.push(newOrder);
                    localStorage.setItem("orders", JSON.stringify(orders));
                    localStorage.removeItem("cart");

                    alert("‚úÖ Thanh to√°n th√†nh c√¥ng!");
                    window.location.href = "donhang.html";
                }
            });
        });
    </script>

</body>
</html>
